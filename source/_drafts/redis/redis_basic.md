# Redis一些列基础知识

## Redis基础

> 常用的数据结构和使用以及其底层实现



## Redis实现分布式锁

所谓分布式锁就是在多个节点都可以访问的位置。设置一个锁标志，任何一个节点想访问共享资源时，首先尝试获取这个标志，如果获取成功表示获取锁成功，如果获取锁失败表示获取锁失败。

使用Redis实现分布式锁，实际就是新增一个redis节点，在redis设置一个key作为锁标志当key存在的时候，就表示资源已经被占用，如果key不存在就表示资源处于空闲状态。

**加锁过程：**

- 判断key是否存在，如果不存在就添加一个

  key是否存在和添加key的操作是原子操作，可以使用setnx方法

**解锁过程：**

* 资源使用完成，再将key删除，释放锁

  注意原子操作

### 问题1: 持有锁的节点在获取锁的时候，宕机了，或者异常结束了。如何解决

获取锁之后宕机，会导致获取锁的节点无法释放锁，进而导致共享资源不可用。解决方式是设置一个过期时间。

### 问题2: 在过期时间内，任务还未结束，如何解决

启动一个子线程，专门用于延长过期时间，当快到过期时间（1/3的时候），重新设置过期时间。