## Http1.1

### 使用长链接（持久连接）机制

1. 改善了使用http的性能开销，避免每次新的连接请求都需要重复新建立tcp连接，以及结束请求时的重复执行断开链接。
2. 只要任意一方没有明确提出断开链接，保持TCP链接状态

### 引入管道机制

TCP的通讯机制时`请求-应答`，也就是我们每一次的的请求都需要等到接收端做出应答之后，才能继续下一次的请求。而管道传输的好处就是。

1. 使用管道机制，使得在一个TCP链接中，客户端可以同时发动多个请求。这样能在长链接的基础上再次提升网络传输的性能。

**举例说明**

<u>客户端需要请求两个资源。以前的做法是，在同一个TCP连接里面，先发送A请求，然后等待服务器做出回应，收到后再发出B请求。管道机制则是允许浏览器同时发出A请求和B请求，但是服务器还是按照顺序，先回应A请求，完成后再回应B请求。</u>

**注意**：虽然支持请求端在一次TCP链接中同时发送多个请求，但是请求到达服务端之后，处理的顺序还是按照先后顺序来的，所以如果最开始的请求响应很慢，这也就导致了整体的请求也会很慢（**队头阻塞**）

![image-20210515192321456](https://i.loli.net/2021/05/15/RlMXLwTZfOHv3VI.png)



## Http2.0

基于HTTPS的，所以其安全性也是有保障的

### 头部压缩

HTTP/2 会压缩头(Header)如果你同时发出多个请求，他们的头是一样的或是相似的，那么，协议会帮你消除重 复的部分。

**具体实现**

 `HPACK 算法:在客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索 引号，以后就不发送同样字段了，只发送索引号，这样就提高速度了`

### 二进制格式

不再以纯文本的形式进行传输，而是全面采用了二进制格式，头部信息和数据体都是二进制，并统称为桢：`头部帧`、`数据帧`，进而提高传输的效率。

### 数据流

数据包不再顺序发送，同一个链接中连续的数据包，可能属于不同的回应或发送方。所以会新增一个标记，用于记录属于哪一个的。

每个请求或回应的所有数据包，称为一个数据流( Stream )。每个数据流都标记着一个独一无二的编号，其中规 定客户端发出的数据流编号为奇数， 服务器发出的数据流编号为偶数

客户端还可以指定数据流的优先级。优先级高的请求，服务器就先响应该请求。

### 多路复用

一个连接中，并发多个请求或响应，而不用按照顺序一一对应，这样也就杜绝了http1.1中的队头阻塞问题。不过还是能够照成阻塞的。因为TCP本身是有重传机制的，一旦出现丢包现象，触发重传机制，这样就导致一个TCP连接中`所有的HTTP请求都要进行等待`

**阻塞点**

1. HTTP/1.1 中的管道( pipeline)传输中如果有一个请求阻塞了，那么队列后请求也统统被阻塞住了 
2. HTTP/2 多个请求复用一个TCP连接，一旦发生丢包，就会阻塞住所有的 HTTP 请求。

### 服务器推送

HTTP/2 还在一定程度上改善了传统的「请求 - 应答」工作模式，服务不再是被动地响应，也可以主动向客户端发送消息。

**举例来说**：在浏览器刚请求 HTML 的时候，就提前把可能会用到的 JS、CSS 文件等静态资源主动发给客户端，减

少延时的等待，也就是服务器推送(Server Push，也叫 Cache Push)。



### HTTP1.1的优化



